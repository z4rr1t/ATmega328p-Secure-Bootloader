#include <stdint.h>
#include <stdio.h>
#include "ecc.h"

#define ECC_CURVE secp192r1
#define NUM_ECC_DIGITS 24

uint8_t private_0[NUM_ECC_DIGITS] = {0x64, 0xF2, 0x04, 0xD7, 0x01, 0x8B, 0xCC, 0xAA, 0x61, 0x17, 0x3E, 0xB6, 0xE1, 0xE8, 0x15, 0x3E, 0x77, 0xB5, 0xC8, 0xA6, 0x0E, 0x0B, 0x9C, 0xE8};
EccPoint public_0 = {
    {0x4F, 0x21, 0x34, 0x41, 0x39, 0x37, 0x46, 0xFF, 0x40, 0x6C, 0x40, 0x4E, 0xD7, 0x97, 0x8F, 0xF7, 0x22, 0xD6, 0x8F, 0x20, 0xAC, 0xC8, 0x01, 0x3A},
    {0x58, 0x0E, 0xBE, 0x72, 0x72, 0xB3, 0xE9, 0xD9, 0xA0, 0x1D, 0xB0, 0xEB, 0xAC, 0x9C, 0x65, 0xDB, 0xBE, 0x92, 0xF0, 0xCA, 0xEE, 0xB1, 0xD0, 0x77}};


void printf_hex(uint8_t *data, size_t length) {
    int i = 0;
    while (i < length) {
        printf("%02x ", data[i]);
        i++;
    }
    printf("\n");
}

int main() {
  printf("Calculating HASH ....\n");

  uint8_t *data = "THIS IS NOT RANDOM DATA";
  uint8_t r[NUM_ECC_DIGITS];
  uint8_t s[NUM_ECC_DIGITS];

  uint8_t hash[] = {0x82, 0xd2, 0xd4, 0x0c, 0x12, 0x5e, 0x8e, 0x12, 0x1d, 0xf3, 0x0a, 0xc8, 0xa3, 0x1b, 0xc3, 0x86};
  uint8_t random[24] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1};

  for (int i = 0; i < 8; i++) hash[16+i] = 0;
//   hash[23] = 1;

  printf("HASH: ");
  printf_hex(hash, 24);
  printf("Signing Data ....\n");
  if (ecdsa_sign(r, s, private_0, random, hash) == 0) printf("Failed to generate signature ...");
  printf("Data Signed ....\n");
  printf_hex((uint8_t *) r, 24);
  printf_hex((uint8_t *) s, 24);

   if (ecdsa_verify(&public_0, hash, r, s) == 1) printf("Data is valid\n");
   else printf("Data is invalid\n");
}

